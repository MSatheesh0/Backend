### GoalNet Backend - Auth & User API Tests
### Use REST Client extension in VS Code to run these requests
### Click "Send Request" above each request to execute

@baseUrl = http://localhost:3000
@contentType = application/json

################################################################################
### HEALTH CHECK
################################################################################

### 1. Health Check - Test if server is running
GET {{baseUrl}}/health

################################################################################
### AUTHENTICATION - OTP FLOW
################################################################################

### 2. Request OTP - Send OTP to email
# This will generate an OTP and send to the email
# Check console output for OTP code (if Gmail not configured)
POST {{baseUrl}}/auth/request-otp
Content-Type: {{contentType}}

{
  "email": "test@example.com"
}

### 3. Request OTP - Another test email
POST {{baseUrl}}/auth/request-otp
Content-Type: {{contentType}}

{
  "email": "user@test.com"
}

### 4. Request OTP - Edge case: Invalid email format
POST {{baseUrl}}/auth/request-otp
Content-Type: {{contentType}}

{
  "email": "invalidemail"
}

### 5. Request OTP - Edge case: Missing email
POST {{baseUrl}}/auth/request-otp
Content-Type: {{contentType}}

{
}

################################################################################
### VERIFY OTP & GET TOKEN
################################################################################

### 6. Verify OTP - Get JWT Token
# Replace "123456" with the actual OTP from console/email
# This will create a new user if email doesn't exist
POST {{baseUrl}}/auth/verify-otp
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "otp": "123456"
}

### 7. Verify OTP - Wrong OTP (should fail)
POST {{baseUrl}}/auth/verify-otp
Content-Type: {{contentType}}

{
  "email": "test@example.com",
  "otp": "000000"
}

### 8. Verify OTP - Missing fields
POST {{baseUrl}}/auth/verify-otp
Content-Type: {{contentType}}

{
  "email": "test@example.com"
}

################################################################################
### USER PROFILE - PROTECTED ROUTES
################################################################################

# NOTE: Replace YOUR_JWT_TOKEN with the token from verify-otp response
@authToken = YOUR_JWT_TOKEN

### 9. Get Current User Profile - Protected
GET {{baseUrl}}/me
Authorization: Bearer {{authToken}}

### 10. Get Profile - No Token (should fail with 401)
GET {{baseUrl}}/me

### 11. Get Profile - Invalid Token (should fail with 401)
GET {{baseUrl}}/me
Authorization: Bearer invalid-token-here

################################################################################
### UPDATE USER PROFILE
################################################################################

### 12. Update User Profile - Complete Profile
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "name": "John Doe",
  "role": "founder",
  "primaryGoal": "fundraising",
  "company": "TechStartup Inc",
  "website": "https://techstartup.com",
  "location": "San Francisco, CA",
  "oneLiner": "Building the future of AI-powered analytics"
}

### 13. Update Profile - Partial Update (Only name)
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "name": "Jane Smith"
}

### 14. Update Profile - Change Role and Goal
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "role": "investor",
  "primaryGoal": "clients"
}

### 15. Update Profile - Invalid Role (should fail)
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "role": "invalid-role"
}

### 16. Update Profile - Invalid Primary Goal (should fail)
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "primaryGoal": "invalid-goal"
}

### 17. Update Profile - All Roles Test
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "role": "mentor"
}

# Valid roles: "founder" | "investor" | "mentor" | "cxo" | "service" | "other"
# Valid goals: "fundraising" | "clients" | "cofounder" | "hiring" | "learn" | "other"

################################################################################
### COMPLETE FLOW - NEW USER SIGNUP
################################################################################

### 18. FLOW Step 1: Request OTP for new user
POST {{baseUrl}}/auth/request-otp
Content-Type: {{contentType}}

{
  "email": "newuser@example.com"
}

### 19. FLOW Step 2: Verify OTP (creates new user)
# Replace with actual OTP from console
POST {{baseUrl}}/auth/verify-otp
Content-Type: {{contentType}}

{
  "email": "newuser@example.com",
  "otp": "123456"
}

# Copy the token from response and set it in @authToken variable above

### 20. FLOW Step 3: Get new user profile
GET {{baseUrl}}/me
Authorization: Bearer {{authToken}}

### 21. FLOW Step 4: Complete profile
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "name": "New User",
  "role": "founder",
  "primaryGoal": "fundraising",
  "company": "My Startup",
  "location": "Chennai, India",
  "oneLiner": "Revolutionizing the startup ecosystem"
}

### 22. FLOW Step 5: Verify updated profile
GET {{baseUrl}}/me
Authorization: Bearer {{authToken}}

################################################################################
### EDGE CASES & ERROR TESTING
################################################################################

### 23. Rate Limiting - Request OTP multiple times
# Try requesting OTP 4+ times in 5 minutes
# Should fail with 429 Too Many Requests
POST {{baseUrl}}/auth/request-otp
Content-Type: {{contentType}}

{
  "email": "ratelimit@test.com"
}

### 24. Expired OTP Test
# Wait 10+ minutes after requesting OTP, then try to verify
# Should fail with "Invalid or expired code"

### 25. Reused OTP Test
# Try to verify the same OTP twice
# Second attempt should fail (OTP marked as consumed)

### 26. Update with Empty Values
PUT {{baseUrl}}/me
Authorization: Bearer {{authToken}}
Content-Type: {{contentType}}

{
  "name": "",
  "company": ""
}

################################################################################
### NOTES & TIPS
################################################################################

# 1. Start MongoDB first:
#    brew services start mongodb-community

# 2. Start the server:
#    npm run dev

# 3. To get OTP codes:
#    - Check terminal console output (if Gmail not configured)
#    - Or check your email inbox

# 4. To update the token:
#    - Copy token from verify-otp response
#    - Replace YOUR_JWT_TOKEN in @authToken variable above
#    - Or replace {{authToken}} directly in each request

# 5. Valid enum values:
#    Roles: founder, investor, mentor, cxo, service, other
#    Goals: fundraising, clients, cofounder, hiring, learn, other

# 6. Test flow:
#    Request OTP → Check console/email → Verify OTP → Get token → Test protected routes

################################################################################
